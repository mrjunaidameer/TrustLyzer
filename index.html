<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trustlyzer by Junaid | Final Security Protocol.</title>
    <!-- Load Tailwind CSS for modern, responsive, dark-themed styling --><script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- CSS VARIABLES & BASE STYLES --- */
        :root {
            --bg-deep: #060914; 
            --card-bg: #111827; 
            --text-light: #f8fafc;
            --primary-color: #4f46e5; 
            --accent-aqua: #00e5ff; 
            --safe-color: #10b981; 
            --warning-color: #f59e0b; 
            --unsafe-color: #ef4444; 
            --safe-bg: #064e3b; 
            --warning-bg: #78350f; 
            --unsafe-bg: #7f1d1d; 
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-deep);
            color: var(--text-light);
            transition: all 0.5s ease;
            background-image: radial-gradient(at 0% 0%, #0d1222 0%, #172554 100%);
            background-attachment: fixed;
        }

        .brand-name {
            font-size: 2.75rem; 
            font-weight: 900; 
            letter-spacing: -0.06em; 
            color: #ffffff;
            text-shadow: 0 0 15px rgba(79, 70, 229, 0.6); 
        }
        
        #input-group-wrapper {
            transition: all 0.3s ease-in-out;
            border: 2px solid transparent; 
            border-radius: 1.25rem; 
        }

        .input-focus-glow {
            box-shadow: 0 0 20px rgba(79, 70, 229, 0.7), 0 0 40px rgba(79, 70, 229, 0.4);
            border-color: var(--primary-color) !important;
        }

        #url-input {
            box-shadow: inset 0 5px 8px rgba(0, 0, 0, 0.5); 
            transition: box-shadow 0.3s ease, border-color 0.3s ease;
            border-color: #334155; 
        }
        #url-input:focus {
             border-color: var(--primary-color); 
        }

        #scan-button {
            border: 3px solid #6366f1; 
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.6); 
            transition: all 0.3s ease;
        }
        #scan-button:hover {
            box-shadow: 0 6px 20px rgba(79, 70, 229, 0.8), inset 0 0 10px rgba(255, 255, 255, 0.2);
        }
        
        .project-cta {
            display: inline-block;
            padding: 0.5rem 1rem;
            margin-top: 0.5rem;
            font-weight: 700;
            font-size: 0.875rem; 
            border-radius: 0.5rem; 
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            background-color: transparent;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        .project-cta:hover {
            color: var(--text-light);
            background-color: var(--primary-color);
            box-shadow: 0 0 15px rgba(79, 70, 229, 0.8);
            transform: translateY(-1px);
        }

        /* Loading spinner animation */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: none;
        }

        .loading .spinner {
            display: block;
        }

        .loading .scan-text {
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Custom glow effect for the result card */
        .result-card-glow {
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5); 
            transition: box-shadow 0.6s ease-in-out, background-color 0.6s ease;
        }

        /* Specific glow styles based on result state */
        .safe { box-shadow: 0 0 60px rgba(16, 185, 129, 0.8), inset 0 0 20px rgba(16, 185, 129, 0.3); background-color: rgba(6, 78, 59, 0.7); border: 1px solid var(--safe-color); } 
        .suspicious { box-shadow: 0 0 60px rgba(245, 158, 11, 0.8), inset 0 0 20px rgba(245, 158, 11, 0.3); background-color: rgba(120, 53, 15, 0.7); border: 1px solid var(--warning-color); } 
        .unsafe { box-shadow: 0 0 60px rgba(239, 68, 68, 0.8), inset 0 0 20px rgba(239, 68, 68, 0.3); background-color: rgba(127, 29, 29, 0.7); border: 1px solid var(--unsafe-color); } 

        /* Animation for result icon */
        .animate-bounce {
            animation: bounce 0.8s infinite alternate;
        }
        @keyframes bounce {
            0% { transform: translateY(0); }
            100% { transform: translateY(-10px); }
        }

        @media (max-width: 768px) {
            .brand-name {
                font-size: 2rem; 
            }
            .brand-name .ml-4 {
                margin-left: 0.75rem; 
                padding-left: 0.75rem; 
            }
            .footer-content {
                flex-direction: column;
                align-items: center;
            }
            #explore-projects-btn {
                position: static;
                margin-bottom: 1rem;
            }
        }
        @media (min-width: 768px) {
            #explore-projects-btn {
                position: absolute;
                top: 1rem;
                right: 1rem;
            }
        }
        
        /* Project Card Styles */
        .project-card-v2 {
            background-color: var(--card-bg);
            border-radius: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            border-left: 5px solid transparent;
            padding: 1.5rem;
        }
        .project-card-v2:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.7);
        }
        
        .project-cta-v2 {
            display: inline-block;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            text-align: center;
            border: 2px solid;
            transition: all 0.3s ease;
        }
        .project-cta-v2:hover {
            color: white;
            transform: translateY(-1px);
        }

        #phub-card { border-left-color: #10b981; }
        #thub-card { border-left-color: #f59e0b; }
        #psite-card { border-left-color: #6366f1; }
        #cproj-card { border-left-color: #0ea5e9; }
        
        #phub-card .project-cta-v2 { border-color: #10b981; color: #10b981; }
        #phub-card .project-cta-v2:hover { background-color: #10b981; box-shadow: 0 0 10px #10b981; }
        
        #thub-card .project-cta-v2 { border-color: #f59e0b; color: #f59e0b; }
        #thub-card .project-cta-v2:hover { background-color: #f59e0b; box-shadow: 0 0 10px #f59e0b; }
        
        #psite-card .project-cta-v2 { border-color: #6366f1; color: #6366f1; }
        #psite-card .project-cta-v2:hover { background-color: #6366f1; box-shadow: 0 0 10px #6366f1; }
        
        #cproj-card .project-cta-v2 { border-color: #0ea5e9; color: #0ea5e9; }
        #cproj-card .project-cta-v2:hover { background-color: #0ea5e9; box-shadow: 0 0 10px #0ea5e9; }

    </style>
</head>
<body class="min-h-screen p-4 md:p-12 flex flex-col items-center">

    <!-- Header - Polished Branding --><header class="w-full max-w-5xl text-center mb-16">
        <div class="brand-name mb-2 flex items-center justify-center">
            <span class="text-primary-color text-5xl mr-3 transform rotate-[-10deg]">üõ°Ô∏è</span> 
            Trustlyzer 
            <!-- Polished "by Junaid" branding with improved tracking and a subtle divider --><span class="text-base ml-4 tracking-wide text-slate-300 font-medium border-l pl-4 border-indigo-500 opacity-90">by Junaid</span>
        </div>
        <p class="text-2xl text-slate-300 font-light mt-1">Browse Fearlessly. Stay Secure.</p>
    </header>

    <main class="w-full max-w-5xl">
        
        <!-- URL Input Section - Polished Look --><div id="input-section" class="bg-card-bg p-6 md:p-12 rounded-2xl shadow-2xl transition-all duration-700 border border-slate-700">
            <h2 class="text-3xl font-bold mb-6 text-white text-center">Security Scan Initiated</h2>
            <form id="url-form" onsubmit="scanWebsite(event)">
                <!-- Input Group Wrapper for Enhanced Focus Glow --><div id="input-group-wrapper" class="flex flex-col md:flex-row gap-4 p-1 rounded-2xl transition-all duration-300 bg-slate-800 border-2 border-slate-700">
                    <input 
                        type="url" 
                        id="url-input" 
                        placeholder="Enter website URL (e.g., https://secure-site.com)" 
                        required 
                        class="flex-grow p-4 text-lg rounded-xl bg-transparent text-white focus:outline-none placeholder:text-slate-500 transition duration-300"
                    />
                    <button 
                        type="submit" 
                        id="scan-button"
                        class="flex items-center justify-center px-8 py-4 bg-primary-color hover:bg-indigo-700 text-lg text-white font-extrabold rounded-xl shadow-xl transition duration-300 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-[1.02]"
                    >
                        <div id="spinner" class="spinner mr-3"></div>
                        <span id="scan-text" class="scan-text">Scan Site</span>
                    </button>
                </div>
            </form>
            <p id="error-message" class="text-red-400 mt-4 text-sm text-center hidden"></p>
        </div>

        <!-- How the Scan Works Section - Polished Look with Icon --><div class="mt-12 p-6 bg-slate-800 rounded-xl shadow-lg border border-slate-700">
            <h3 class="text-xl font-semibold mb-3 text-primary-color flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                How the Scan Works (Max-Level Heuristic Analysis)
            </h3>
            <p class="text-slate-400 text-sm leading-relaxed">
                This tool uses advanced heuristics, analyzing Domain Randomness (Entropy), Phishing Keywords (in the full URL and path), TLD risk, and URL complexity. This is the most accurate real-time analysis possible without accessing a server-side global threat database. Always use common sense alongside this report.
            </p>
        </div>

        <!-- Result Section (Initially Hidden) - Polished Appearance --><div id="result-section" class="mt-16 hidden transition-all duration-700 ease-out opacity-0">
            <div id="result-card" class="result-card-glow p-8 md:p-12 rounded-2xl transition-all duration-500">
                <div class="flex items-center mb-8">
                    <span id="result-icon" class="text-6xl mr-6"></span> <div>
                        <p class="text-xl font-medium text-slate-300">Scan Status:</p>
                        <h3 id="result-main-text" class="text-4xl font-extrabold"></h3>
                    </div>
                </div>

                <div id="result-details" class="space-y-6">
                    <div id="current-url-display" class="bg-slate-700 p-4 rounded-xl text-lg break-all border-l-4 border-primary-color">
                        <strong class="text-slate-400">URL Scanned:</strong> <span id="scanned-url" class="text-white font-mono"></span>
                    </div>

                    <!-- Heuristic Analysis Section - Polished List --><div class="bg-slate-800 p-5 rounded-xl shadow-inner border border-slate-700">
                        <h4 class="text-2xl font-bold mb-4 text-white">Full Security Report:</h4>
                        <ul id="analysis-list" class="space-y-3 text-base text-slate-300">
                            <!-- Analysis points will be inserted here --></ul>
                    </div>
                </div>

                <div class="mt-8 flex flex-col md:flex-row md:justify-between items-center text-sm text-slate-400 border-t border-slate-700 pt-6">
                    <p>Last Scan Time: <span id="scan-time" class="text-white font-semibold"></span></p>
                    <div class="flex items-center mt-3 md:mt-0">
                        <p class="mr-2">Simulated Privacy Score:</p>
                        <span id="privacy-score" class="text-3xl font-extrabold"></span> <span class="text-xl">/ 100</span>
                    </div>
                </div>

                <button 
                    id="check-another-button" 
                    onclick="resetApp()"
                    class="mt-10 w-full px-6 py-4 bg-slate-600 hover:bg-slate-500 text-lg text-white font-bold rounded-xl transition duration-300 focus-ring transform hover:translate-y-[-2px] shadow-md"
                >
                    Check Another Site
                </button>
            </div>
        </div>
    </main>
    
    <!-- Projects Showcase Section (New) -->
    <div id="projects-showcase" class="w-full max-w-5xl mt-16 hidden transition-all duration-700 ease-out opacity-0">
        <h3 class="text-3xl font-bold mb-8 text-primary-color text-center">Junaid's Other Projects</h3>
        <div class="grid grid-cols-1 gap-8 md:grid-cols-2">
            <!-- Project Card 1: PrepHub (Emerald Accent) -->
            <div id="phub-card" class="project-card-v2">
                <h4 class="text-xl font-bold text-white mb-2 flex items-center">
                    <span class="mr-3 text-2xl text-emerald-400">üìù</span> JunaidPrepHub
                </h4>
                <p class="text-slate-400 mb-6 text-sm">An online testing platform where students can practice tests and receive instant results for preparation and knowledge growth.</p>
                <a href="https://junaidprephub.junaidprojects.site/" target="_blank" class="project-cta-v2">
                    Explore Platform &rarr;
                </a>
            </div>
            <!-- Project Card 2: TypeHub (Amber Accent) -->
            <div id="thub-card" class="project-card-v2">
                <h4 class="text-xl font-bold text-white mb-2 flex items-center">
                    <span class="mr-3 text-2xl text-amber-400">‚å®Ô∏è</span> JunaidTypeHub
                </h4>
                <p class="text-slate-400 mb-6 text-sm">A dedicated tool for users to improve their typing skills through focused and interactive practice exercises.</p>
                <a href="https://junaidtypehub.junaidprojects.site/" target="_blank" class="project-cta-v2">
                    Start Typing &rarr;
                </a>
            </div>
            <!-- Project Card 3: Personal Site (Indigo Accent) -->
            <div id="psite-card" class="project-card-v2">
                <h4 class="text-xl font-bold text-white mb-2 flex items-center">
                    <span class="mr-3 text-2xl text-indigo-400">üë®‚Äçüíª</span> Junaid Personal Site
                </h4>
                <p class="text-slate-400 mb-6 text-sm">The main hub to connect with Junaid Ameer and learn about his background, skills, and professional journey.</p>
                <a href="https://junaidameer.online" target="_blank" class="project-cta-v2">
                    View Resume/Portfolio &rarr;
                </a>
            </div>
            <!-- Project Card 4: Creative Projects Hub (Sky Accent) -->
            <div id="cproj-card" class="project-card-v2">
                <h4 class="text-xl font-bold text-white mb-2 flex items-center">
                    <span class="mr-3 text-2xl text-sky-400">üí°</span> Junaid Creative Projects
                </h4>
                <p class="text-slate-400 mb-6 text-sm">An overview of other creative web development projects, tools, and simulations built by Junaid.</p>
                <a href="https://junaidprojects.site" target="_blank" class="project-cta-v2">
                    See Creative Tools &rarr;
                </a>
            </div>
        </div>
    </div>

    <!-- Footer / About Section - Relocated Projects Toggle Button -->
    <footer class="w-full max-w-5xl mt-24 p-6 md:p-8 border-t border-slate-700 text-center text-slate-400 bg-slate-900/30 rounded-t-xl relative">
        <!-- Explore Projects Button - Small and in the Corner (Relative to footer) -->
        <button id="explore-projects-btn" onclick="toggleProjects()" class="text-red-500 font-bold hover:text-red-300 transition duration-300 px-3 py-1.5 text-sm border border-red-500 rounded-lg hover:bg-red-900/50">
            Explore Projects &darr;
        </button>

        <div class="footer-content">
            <h3 class="text-xl font-semibold mb-3 text-white mt-4 md:mt-0">About Trustlyzer</h3>
            <p class="text-sm leading-relaxed">
                Trustlyzer is a passion project by <strong class="text-primary-color font-bold">Junaid Ameer</strong>, demonstrating the limits and power of advanced client-side security heuristics. It promotes a fearless and secure browsing experience.
            </p>
            <p class="text-xs mt-6 opacity-70">&copy; 2025 Trustlyzer by Junaid. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Global state and configuration
        const urlInput = document.getElementById('url-input');
        const scanButton = document.getElementById('scan-button');
        const errorMessage = document.getElementById('error-message');
        const inputSection = document.getElementById('input-section');
        const resultSection = document.getElementById('result-section');
        const resultCard = document.getElementById('result-card');
        const resultIcon = document.getElementById('result-icon');
        const resultMainText = document.getElementById('result-main-text');
        const scannedUrlDisplay = document.getElementById('scanned-url');
        const analysisList = document.getElementById('analysis-list');
        const scanTime = document.getElementById('scan-time');
        const privacyScore = document.getElementById('privacy-score');
        const inputGroupWrapper = document.getElementById('input-group-wrapper'); 
        const projectsShowcase = document.getElementById('projects-showcase');
        const projectsBtn = document.getElementById('explore-projects-btn');

        // --- KNOWN MALICIOUS DOMAINS FOR REALISTIC DETECTION (SIMULATED BLACKLIST) ---
        const knownUnsafeDomains = [
            'scam-site-test.com', 
            'fake-crypto-exchange.xyz', 
            'free-money-login.site',
            'paypal-security-update.online',
            'google-verifly.top', 
            'gambling-fraud.live',
            'login.phishingdomain.cn'
        ];
        // --------------------------------------------------------------------------

        // --- Event Listeners for Input Bar Focus Glow ---
        urlInput.addEventListener('focus', () => {
            inputGroupWrapper.classList.add('input-focus-glow');
        });
        urlInput.addEventListener('blur', () => {
            inputGroupWrapper.classList.remove('input-focus-glow');
        });
        
        /**
         * Calculates Shannon entropy for a string (measures randomness).
         */
        function calculateEntropy(str) {
            const charCounts = {};
            for (const char of str) {
                charCounts[char] = (charCounts[char] || 0) + 1;
            }
            let entropy = 0;
            const totalChars = str.length;
            for (const char in charCounts) {
                const probability = charCounts[char] / totalChars;
                entropy -= probability * Math.log2(probability);
            }
            return entropy;
        }

        /**
         * Heuristically analyzes a URL for common phishing and unsafe indicators.
         */
        function checkUrlSafety(url) {
            const result = {
                status: 'SAFE', // SAFE, SUSPICIOUS, UNSAFE
                color: 'var(--safe-color)',
                bgColor: 'var(--safe-bg)',
                icon: '‚úÖ',
                message: 'This site looks safe!',
                analysis: [],
                score: 100 
            };
            
            let isSuspicious = false;
            let isUnsafe = false;
            const deductionMap = {
                'https_warning': 20,
                'suspicious_tld': 15,
                'ip_address': 40,
                'subdomain_abuse': 15,
                'common_phishing_word': 40,
                'full_url_suspicion': 25,
                'high_entropy': 20,         // Domain Randomness
                'lifetime_promise': 30,     // High-value scam keywords
                'excessive_length': 15,     // Overall length check
                'long_redirect_path': 20,   // Redirect chain simulation
            };

            let hostname, rootDomain;
            try {
                const tempUrl = url.startsWith('http') ? url : 'https://' + url;
                const urlObj = new URL(tempUrl); 
                hostname = urlObj.hostname.toLowerCase();
                const parts = hostname.split('.');
                rootDomain = parts.slice(-2).join('.');
                
            } catch (e) {
                result.status = 'UNSAFE';
                result.message = 'üö® ERROR: Malformed URL/Input. Please ensure correct format.';
                result.icon = 'üõë';
                result.color = 'var(--unsafe-color)';
                result.bgColor = 'var(--unsafe-bg)';
                result.analysis.push({ text: 'üö® Malformed URL: Cannot parse. High risk of intentional cloaking or invalid input.', type: 'unsafe' });
                result.score = 0;
                return result; 
            }

            // ====================================================================
            // 1. BLACKLIST CHECK - Highest Priority
            // ====================================================================
            if (knownUnsafeDomains.some(domain => hostname.includes(domain))) {
                result.analysis.push({
                    text: 'üõë DEFINITIVE THREAT: Domain is on a simulated list of known scam/phishing sites.',
                    type: 'unsafe'
                });
                isUnsafe = true;
                result.score = 5; 
            } else {
                result.analysis.push({
                    text: '‚úÖ Blacklist Status: No direct match found in the simulated blacklist.',
                    type: 'safe'
                });
                
                // --- HEURISTIC CHECKS START (Only run if not definitively UNSAFE by blacklist) ---

                // 2. HTTPS Check 
                if (!url.startsWith('https://')) {
                    result.analysis.push({
                        text: '‚ö†Ô∏è HTTPS NOT FOUND: The site does not use HTTPS. Data transmitted may not be encrypted.',
                        type: 'warning'
                    });
                    result.score -= deductionMap.https_warning;
                    isSuspicious = true;
                } else {
                    result.analysis.push({
                        text: '‚úÖ Uses HTTPS: All data transmission is encrypted and secure.',
                        type: 'safe'
                    });
                }

                // 3. Suspicious TLDs Check 
                const suspiciousTlds = ['.zip', '.xyz', '.site', '.top', '.live', '.cn', '.tk'];
                const tld = rootDomain.split('.').pop();
                
                if (suspiciousTlds.includes('.' + tld) || (tld.length > 2 && tld !== 'com' && tld !== 'org' && tld !== 'net' && tld !== 'info')) {
                    result.analysis.push({
                        text: `‚ö†Ô∏è Suspicious TLD (.${tld}) Detected: TLD is commonly associated with lower-trust or new sites.`,
                        type: 'warning'
                    });
                    result.score -= deductionMap.suspicious_tld;
                    isSuspicious = true;
                } else {
                    result.analysis.push({
                        text: '‚úÖ Domain TLD: Uses a standard, lower-risk TLD.',
                        type: 'safe'
                    });
                }

                // 4. IP Address in Domain Check
                const ipRegex = /^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/;
                if (ipRegex.test(hostname)) {
                    result.analysis.push({
                        text: 'üö® IP Address Used: The site uses a raw IP address, a strong indicator of low effort or malicious intent.',
                        type: 'unsafe'
                    });
                    result.score -= deductionMap.ip_address;
                    isUnsafe = true;
                }

                // 5. Excessive Subdomains 
                const parts = hostname.split('.');
                if (parts.length > 4) {
                    result.analysis.push({
                        text: '‚ö†Ô∏è Excessive Subdomains: Too many subdomains might be an attempt to mask the true root domain.',
                        type: 'warning'
                    });
                    result.score -= deductionMap.subdomain_abuse;
                    isSuspicious = true;
                }

                // 6. Domain Randomness (High Entropy Check)
                const domainNamePart = rootDomain.split('.').slice(0, -1)[0];
                const entropy = calculateEntropy(domainNamePart);
                if (domainNamePart.length > 8 && entropy > 3.4) {
                     result.analysis.push({
                        text: 'üö® High Randomness Detected: Domain name appears highly random or machine-generated (High Entropy).',
                        type: 'unsafe'
                    });
                    result.score -= deductionMap.high_entropy;
                    isUnsafe = true;
                }

                // 7. Overall Domain/Path Length Check
                if (url.length > 100) {
                     result.analysis.push({
                        text: '‚ö†Ô∏è Excessive URL Length: URL is very long (over 100 characters), potentially to obscure the host or use aggressive tracking.',
                        type: 'warning'
                    });
                    result.score -= deductionMap.excessive_length;
                    isSuspicious = true;
                }
                
                // 8. Simulated Excessive Path/Query Length (Redirect Abuse)
                const pathAndQuery = url.substring(url.indexOf(hostname) + hostname.length);
                if (pathAndQuery.length > 80 && pathAndQuery.includes('=')) {
                    result.analysis.push({
                        text: '‚ö†Ô∏è Deep Path / Aggressive Query: Very long path or complex query parameters (simulated redirect/tracking abuse).',
                        type: 'warning'
                    });
                    result.score -= deductionMap.long_redirect_path;
                    isSuspicious = true;
                }

                // 9. Common Phishing/Scam Keywords in the FULL URL (Domain + Path + Query)
                const fullUrlLowerCase = url.toLowerCase();
                const phishingKeywords = ['login', 'secure', 'verify', 'bank', 'account', 'paypal', 'apple', 'crypto', 'bonus', 'claim', 'transfer', 'update', 'payment', 'prize', 'refund'];
                const lifetimePromiseKeywords = ['guaranteed-returns', 'instant-payout', 'get-rich-quick', 'dataentryjob', 'onlinejob', 'freemoney', 'workfromhome', 'gambling', 'casino']; // Added gambling/casino here
                
                let promiseMatch = lifetimePromiseKeywords.find(keyword => fullUrlLowerCase.includes(keyword.replace(/-/g, ''))); 

                if (promiseMatch) {
                    result.analysis.push({
                        text: `üö® Scam Keyword Detected: Domain/Path includes high-risk terms like "${promiseMatch.replace(/-/g, ' ')}" (indicates low-effort scam/fraud).`,
                        type: 'unsafe'
                    });
                    result.score -= deductionMap.lifetime_promise; 
                    isUnsafe = true;
                }

                let keywordMatch = phishingKeywords.find(keyword => fullUrlLowerCase.includes(keyword));

                if (keywordMatch && !promiseMatch) { 
                    if (rootDomain.includes(keywordMatch) || keywordMatch.includes('login') || keywordMatch.includes('bank')) {
                        result.analysis.push({
                             text: `üö® Keyword Alert: High-risk keyword "${keywordMatch}" detected in the domain. HIGH PHISHING RISK.`,
                             type: 'unsafe'
                         });
                         result.score -= deductionMap.common_phishing_word; 
                         isUnsafe = true;
                    } else {
                         result.analysis.push({
                             text: `‚ö†Ô∏è Keyword Alert: Suspicious word "${keywordMatch}" detected in the URL path/query.`,
                             type: 'warning'
                         });
                         result.score -= deductionMap.full_url_suspicion; 
                         isSuspicious = true;
                    }
                 } else if (!promiseMatch) {
                    result.analysis.push({
                        text: '‚úÖ No High-Risk Keywords: The URL path and domain appear clean of common scam words.',
                        type: 'safe'
                    });
                 }
            }


            // Final Status Determination
            if (isUnsafe) {
                result.status = 'UNSAFE';
                result.message = 'üö® DANGER! UNCONFIRMED OR PHISHING WEBSITE DETECTED.';
                result.icon = 'üõë';
                result.color = 'var(--unsafe-color)';
                result.bgColor = 'var(--unsafe-bg)';
            } else if (result.score <= 70 || isSuspicious) { 
                result.status = 'SUSPICIOUS';
                result.message = '‚ö†Ô∏è This site is suspicious. Proceed with EXTREME caution.';
                result.icon = '‚ö†Ô∏è';
                result.color = 'var(--warning-color)';
                result.bgColor = 'var(--warning-bg)';
            } else {
                result.status = 'SAFE';
                result.message = '‚úÖ Site appears safe based on our analysis.';
                result.icon = '‚úÖ';
                result.color = 'var(--safe-color)';
                result.bgColor = 'var(--safe-bg)';
            }
            
            result.analysis.push({
                text: `üõ°Ô∏è Overall Confidence Score: ${result.score}/100. Always check the full report.`,
                type: result.status.toLowerCase()
            });

            result.score = Math.max(0, Math.round(result.score));

            return result;
        }

        // --- Helper and UI Functions (Optimized and Finalized) ---
        
        function simulateSafeBrowsing(url) {
            return new Promise((resolve) => {
                const latency = Math.floor(Math.random() * 500) + 500;
                setTimeout(() => {
                    const result = checkUrlSafety(url);
                    resolve(result);
                }, latency);
            });
        }

        function displayResult(result, scannedUrl) {
            resultCard.className = `p-8 md:p-12 rounded-2xl transition-all duration-500 result-card-glow ${result.status.toLowerCase()}`;
            resultIcon.textContent = result.icon;
            if (result.status !== 'SAFE') {
                resultIcon.classList.add('animate-bounce');
            } else {
                resultIcon.classList.remove('animate-bounce');
            }
            resultMainText.textContent = result.message;
            resultMainText.style.color = result.color;
            scannedUrlDisplay.textContent = scannedUrl;
            analysisList.innerHTML = '';
            result.analysis.forEach(item => {
                const li = document.createElement('li');
                let colorClass;
                if (item.type === 'safe') {
                    colorClass = 'text-emerald-300';
                } else if (item.type === 'warning') {
                    colorClass = 'text-amber-300';
                } else {
                    colorClass = 'text-red-300 font-semibold';
                }
                const itemIcon = item.type === 'safe' ? 
                                        '<span class="text-emerald-400 mr-3 text-lg">‚úì</span>' : 
                                        item.type === 'warning' ? 
                                        '<span class="text-amber-400 mr-3 text-lg">!</span>' : 
                                        '<span class="text-red-400 mr-3 text-lg">‚úó</span>';
                li.className = `${colorClass} flex items-start`;
                li.innerHTML = `${itemIcon} <span>${item.text}</span>`;
                analysisList.appendChild(li);
            });
            scanTime.textContent = new Date().toLocaleTimeString();
            privacyScore.textContent = result.score;
            privacyScore.className = `font-extrabold transition-colors duration-500 ${result.score >= 80 ? 'text-green-400' : result.score >= 50 ? 'text-amber-400' : 'text-red-400'}`;
            inputSection.classList.add('hidden');
            resultSection.classList.remove('hidden');
            void resultSection.offsetWidth; 
            resultSection.style.opacity = '1';
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        function toggleLoading(isLoading) {
            const spinnerEl = document.getElementById('spinner');
            const scanTextEl = document.getElementById('scan-text');
            scanButton.disabled = isLoading;
            if (isLoading) {
                scanButton.classList.add('loading');
                errorMessage.classList.add('hidden');
                scanTextEl.textContent = 'Scanning...';
                spinnerEl.style.display = 'block';
            } else {
                scanButton.classList.remove('loading');
                scanTextEl.textContent = 'Scan Site';
                spinnerEl.style.display = 'none';
            }
        }

        function validateAndSanitizeUrl(url) {
            if (!url) {
                throw new Error("Please enter a URL to scan.");
            }
            if (!url.includes('.')) {
                throw new Error("Invalid URL format. Check the domain name or path.");
            }
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                return 'https://' + url; 
            }
            return url;
        }

        async function scanWebsite(event) {
            event.preventDefault();
            const rawUrl = urlInput.value.trim();
            try {
                const scannedUrl = validateAndSanitizeUrl(rawUrl);
                toggleLoading(true);
                const result = await simulateSafeBrowsing(scannedUrl);
                displayResult(result, scannedUrl);
            } catch (error) {
                console.error("Scan Error:", error);
                errorMessage.textContent = `Error: ${error.message}`;
                errorMessage.classList.remove('hidden');
            } finally {
                toggleLoading(false); 
            }
        }

        function resetApp() {
            errorMessage.classList.add('hidden');
            resultCard.className = 'p-8 md:p-12 rounded-2xl transition-all duration-500 result-card-glow'; 
            resultCard.style.backgroundColor = 'var(--card-bg)'; 
            resultSection.style.opacity = '0'; 
            setTimeout(() => {
                resultSection.classList.add('hidden');
                inputSection.classList.remove('hidden');
                inputSection.scrollIntoView({ behavior: 'smooth' });
                resultIcon.classList.remove('animate-bounce'); 
            }, 500); 
        }

        function toggleProjects() {
            if (projectsShowcase.classList.contains('hidden')) {
                projectsShowcase.classList.remove('hidden');
                void projectsShowcase.offsetWidth; 
                projectsShowcase.style.opacity = '1';
                projectsBtn.innerHTML = 'Collapse Projects &uarr;';
                projectsShowcase.scrollIntoView({ behavior: 'smooth' });
            } else {
                projectsShowcase.style.opacity = '0';
                setTimeout(() => {
                    projectsShowcase.classList.add('hidden');
                    projectsBtn.innerHTML = 'Explore Projects &darr;';
                }, 700); 
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            resultSection.classList.add('hidden');
            resultSection.style.opacity = '0'; 
            projectsShowcase.classList.add('hidden');
            projectsShowcase.style.opacity = '0';
        });

    </script>
</body>
</html>